{% extends 'base.html' %}

{% block title %}ì˜¤ëŠ˜ì˜ ìš´ì„¸ - Fortune Life{% endblock %}

{% block extra_css %}
<style>
    .fortune-circle {
        position: relative;
        width: 220px;
        height: 220px;
        margin: 0 auto;
    }
    
    .fortune-circle svg {
        transform: rotate(0deg) scaleY(1);
        transform-origin: center;
        filter: drop-shadow(0 0 10px rgba(124, 58, 237, 0.3));
    }
    
    .fortune-circle-bg {
        fill: none;
        stroke: rgba(255, 255, 255, 0.1);
        stroke-width: 15;
    }
    
    .fortune-circle-progress {
        fill: none;
        stroke: url(#gradient);
        stroke-width: 15;
        stroke-linecap: round;
        stroke-dasharray: 628;
        stroke-dashoffset: 628;
        transition: stroke-dashoffset 2s ease-out;
    }
    
    .fortune-score-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }
    
    .fortune-score-text .score {
        font-size: 4rem;
        font-weight: 800;
        background: linear-gradient(135deg, #fff 0%, #a78bfa 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 20px rgba(167, 139, 250, 0.5);
    }
    
    .fortune-score-text .label {
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.7);
        font-weight: 300;
    }
    
    .sub-score-bar {
        position: relative;
        height: 25px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        overflow: hidden;
        margin: 15px 0;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .sub-score-fill {
        height: 100%;
        border-radius: 20px;
        transition: width 1.5s ease-out;
        position: relative;
    }

    .sub-score-bar .score-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: bold;
        font-size: 0.85rem;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        z-index: 1;
    }
    
    /* Removed conflicting fortune-tabs styles to use global nav-pills style */
    
    .fortune-text {
        line-height: 1.8;
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.1rem;
        text-align: justify;
        margin-top: 25px;
        padding: 20px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .lucky-item-box {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        margin: 20px 0;
        transition: transform 0.3s;
    }
    
    .lucky-item-box:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.08);
        border-color: var(--primary);
    }
    
    .lucky-item-icon {
        font-size: 3rem;
        filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
    }
    
    .lotto-numbers {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 30px 0;
        flex-wrap: wrap;
    }
    
    .lotto-ball {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        color: white;
        font-size: 1.4rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3), inset 0 -5px 10px rgba(0,0,0,0.2), inset 0 5px 10px rgba(255,255,255,0.3);
        border: 2px solid rgba(255, 255, 255, 0.2);
        text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    .lucky-colors-container {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin: 30px 0;
        flex-wrap: wrap;
    }

    .lucky-color-item {
        text-align: center;
    }

    .lucky-color-circle {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin: 0 auto 15px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3), inset 0 -5px 10px rgba(0,0,0,0.2), inset 0 5px 10px rgba(255,255,255,0.2);
        border: 3px solid rgba(255, 255, 255, 0.3);
        transition: transform 0.3s ease;
    }

    .lucky-color-circle:hover {
        transform: scale(1.1);
    }

    .lucky-color-name {
        font-size: 1.1rem;
        font-weight: 600;
        color: white;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .lucky-color-description {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
        margin-top: 5px;
    }

    /* í–‰ìš´ ì•„ì´í…œ ì¹´ë“œ */
    .lucky-item-card {
        transition: transform 0.3s, box-shadow 0.3s;
        cursor: pointer;
    }

    .lucky-item-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(124, 58, 237, 0.3);
    }

    .item-desc-toggle {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out, opacity 0.3s ease-out, margin 0.3s ease-out;
        opacity: 0;
        margin-top: 0;
    }

    .item-desc-toggle.show {
        max-height: 200px;
        opacity: 1;
        margin-top: 15px;
    }

    .item-desc-toggle p {
        padding: 15px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        line-height: 1.6;
    }

    .toggle-hint {
        color: rgba(255, 255, 255, 0.5);
        transition: color 0.2s;
    }

    .lucky-item-card:hover .toggle-hint {
        color: rgba(255, 255, 255, 0.8);
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center mb-5">
        <div class="col-lg-10 text-center">
            <h1 class="display-4 text-white mb-3 fw-bold">
                <i class="fas fa-crystal-ball text-primary me-3"></i>
                ì˜¤ëŠ˜ì˜ ìš´ì„¸
            </h1>
            <p class="lead text-white opacity-75">ë‹¹ì‹ ì˜ ì˜¤ëŠ˜ì„ ë¹›ë‚¼ ìš´ì„¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”</p>
        </div>
    </div>

    {% if fortune %}
    <div class="row justify-content-center mb-4">
        <div class="col-lg-10">
            <div class="glass-card p-5">
                <div class="fortune-circle">
                    <svg width="220" height="220">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle cx="110" cy="110" r="100" class="fortune-circle-bg"></circle>
                        <circle cx="110" cy="110" r="100" class="fortune-circle-progress"
                                data-score="{{ fortune.fortune_score|default:0 }}"></circle>
                    </svg>
                    <div class="fortune-score-text">
                        <div class="score">{{ fortune.fortune_score|default:0 }}</div>
                        <div class="label">ì </div>
                    </div>
                </div>

                <div class="row text-center mt-5 g-3 justify-content-center">
                    <div class="col-md-4">
                        <h6 class="text-primary-light mb-2">ë³„ìë¦¬</h6>
                        <span class="badge rounded-pill bg-primary bg-opacity-25 border border-primary text-white fs-5 px-4 py-2">
                            {{ fortune.zodiac_sign|default:"-" }}
                        </span>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-primary-light mb-2">ë </h6>
                        <span class="badge rounded-pill bg-success bg-opacity-25 border border-success text-white fs-5 px-4 py-2">
                            {{ fortune.chinese_zodiac|default:"-" }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fortune Details Tabs -->
    <div class="row justify-content-center mb-4">
        <div class="col-lg-10">
            <div class="glass-card overflow-hidden">
            <div class="card-header border-0 p-4">
                <ul class="nav nav-pills fortune-tabs nav-fill gap-2" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="tab-total" data-bs-toggle="tab" href="#total">ì¢…í•©ìš´</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="tab-money" data-bs-toggle="tab" href="#money">ì¬ë¬¼ìš´</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="tab-love" data-bs-toggle="tab" href="#love">ì—°ì• ìš´</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="tab-study" data-bs-toggle="tab" href="#study">í•™ì—…ìš´</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="tab-work" data-bs-toggle="tab" href="#work">ì§ì¥ìš´</a>
                    </li>
                </ul>
            </div>
            <div class="card-body p-4 p-md-5">
                <div class="tab-content">
                    <!-- ì¢…í•©ìš´ -->
                    <div class="tab-pane fade show active" id="total">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="text-white"><i class="fas fa-star text-warning me-2"></i> ì¢…í•©ìš´</h4>
                            <span class="badge fs-6" style="background: rgba(124, 58, 237, 0.3); border: 1px solid rgba(124, 58, 237, 0.5); color: white;">{{ fortune.fortune_score|default:0 }}/100ì </span>
                        </div>
                        <div class="sub-score-bar">
                            <span class="score-text">{{ fortune.fortune_score|default:0 }}%</span>
                            <div class="sub-score-fill" style="width: {{ fortune.fortune_score|default:0 }}%; background: linear-gradient(90deg, #7c3aed, #a78bfa);"></div>
                        </div>
                        <p class="fortune-text">
                            {{ fortune.fortune_texts.total|default:"ì˜¤ëŠ˜ì˜ ìš´ì„¸ ë‚´ìš©" }}
                        </p>
                    </div>

                    <!-- ì¬ë¬¼ìš´ -->
                    <div class="tab-pane fade" id="money">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="text-white"><i class="fas fa-coins text-warning me-2"></i> ì¬ë¬¼ìš´</h4>
                            <span class="badge fs-6" style="background: rgba(245, 158, 11, 0.3); border: 1px solid rgba(245, 158, 11, 0.5); color: white;">{{ fortune.money_score|default:70 }}/100ì </span>
                        </div>
                        <div class="sub-score-bar">
                            <span class="score-text">{{ fortune.money_score|default:70 }}%</span>
                            <div class="sub-score-fill" style="width: {{ fortune.money_score|default:70 }}%; background: linear-gradient(90deg, #f59e0b, #fbbf24);"></div>
                        </div>
                        <p class="fortune-text">
                            {{ fortune.fortune_texts.money|default:"ì¬ë¬¼ìš´ ë‚´ìš©" }}
                        </p>
                    </div>

                    <!-- ì—°ì• ìš´ -->
                    <div class="tab-pane fade" id="love">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="text-white"><i class="fas fa-heart text-danger me-2"></i> ì—°ì• ìš´</h4>
                            <span class="badge fs-6" style="background: rgba(239, 68, 68, 0.3); border: 1px solid rgba(239, 68, 68, 0.5); color: white;">{{ fortune.love_score|default:65 }}/100ì </span>
                        </div>
                        <div class="sub-score-bar">
                            <span class="score-text">{{ fortune.love_score|default:65 }}%</span>
                            <div class="sub-score-fill" style="width: {{ fortune.love_score|default:65 }}%; background: linear-gradient(90deg, #ef4444, #f87171);"></div>
                        </div>
                        <p class="fortune-text">
                            {{ fortune.fortune_texts.love|default:"ì—°ì• ìš´ ë‚´ìš©" }}
                        </p>
                    </div>

                    <!-- í•™ì—…ìš´ -->
                    <div class="tab-pane fade" id="study">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="text-white"><i class="fas fa-graduation-cap text-info me-2"></i> í•™ì—…ìš´</h4>
                            <span class="badge fs-6" style="background: rgba(59, 130, 246, 0.3); border: 1px solid rgba(59, 130, 246, 0.5); color: white;">{{ fortune.study_score|default:75 }}/100ì </span>
                        </div>
                        <div class="sub-score-bar">
                            <span class="score-text">{{ fortune.study_score|default:75 }}%</span>
                            <div class="sub-score-fill" style="width: {{ fortune.study_score|default:75 }}%; background: linear-gradient(90deg, #3b82f6, #60a5fa);"></div>
                        </div>
                        <p class="fortune-text">
                            {{ fortune.fortune_texts.study|default:"í•™ì—…ìš´ ë‚´ìš©" }}
                        </p>
                    </div>

                    <!-- ì§ì¥ìš´ -->
                    <div class="tab-pane fade" id="work">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="text-white"><i class="fas fa-briefcase text-success me-2"></i> ì§ì¥ìš´</h4>
                            <span class="badge fs-6" style="background: rgba(16, 185, 129, 0.3); border: 1px solid rgba(16, 185, 129, 0.5); color: white;">{{ fortune.work_score|default:80 }}/100ì </span>
                        </div>
                        <div class="sub-score-bar">
                            <span class="score-text">{{ fortune.work_score|default:80 }}%</span>
                            <div class="sub-score-fill" style="width: {{ fortune.work_score|default:80 }}%; background: linear-gradient(90deg, #10b981, #34d399);"></div>
                        </div>
                        <p class="fortune-text">
                            {{ fortune.fortune_texts.work|default:"ì§ì¥ìš´ ë‚´ìš©" }}
                        </p>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- Lucky Colors Section -->
    <div class="row justify-content-center mb-4">
        <div class="col-lg-10">
            <div class="glass-card">
                <div class="card-body p-4 p-md-5">
                    <h4 class="text-white text-center mb-4">
                        <i class="fas fa-palette text-primary me-2"></i>
                        ì˜¤ëŠ˜ì˜ í–‰ìš´ìƒ‰
                    </h4>
                    <h5 class="text-center text-white opacity-90 mb-4">ì˜¤ëŠ˜ ë‹¹ì‹ ì—ê²Œ í–‰ìš´ì„ ê°€ì ¸ë‹¤ ì¤„ ìƒ‰ìƒ</h5>

                    {% if fortune.lucky_colors %}
                    <div class="d-flex justify-content-center flex-wrap">
                        {% for color in fortune.lucky_colors %}
                        <div class="m-3 text-center">
                            <div style="width: 100px; height: 100px; border-radius: 50%; margin: 0 auto; box-shadow: 0 8px 20px rgba(0,0,0,0.3), inset 0 -5px 10px rgba(0,0,0,0.2), inset 0 5px 10px rgba(255,255,255,0.2); border: 3px solid rgba(255, 255, 255, 0.3); background:
                                {% if color == 'ë¹¨ê°„ìƒ‰' %}#FF0000
                                {% elif color == 'ì§„í•œ ë¹¨ê°„ìƒ‰' %}#8B0000
                                {% elif color == 'ì£¼í™©ìƒ‰' %}#FFA500
                                {% elif color == 'ë…¸ë€ìƒ‰' %}#FFFF00
                                {% elif color == 'ì´ˆë¡ìƒ‰' %}#00FF00
                                {% elif color == 'ì—°ë‘ìƒ‰' %}#90EE90
                                {% elif color == 'í•˜ëŠ˜ìƒ‰' %}#87CEEB
                                {% elif color == 'íŒŒë€ìƒ‰' %}#0000FF
                                {% elif color == 'ë‚¨ìƒ‰' %}#000080
                                {% elif color == 'ë³´ë¼ìƒ‰' %}#800080
                                {% elif color == 'ì—°ë³´ë¼ìƒ‰' %}#DA70D6
                                {% elif color == 'ë¶„í™ìƒ‰' %}#FFC0CB
                                {% elif color == 'ê°ˆìƒ‰' %}#8B4513
                                {% elif color == 'ë² ì´ì§€ìƒ‰' %}#F5DEB3
                                {% elif color == 'ê²€ì€ìƒ‰' %}#000000
                                {% elif color == 'í°ìƒ‰' %}#FFFFFF
                                {% elif color == 'íšŒìƒ‰' %}#808080
                                {% elif color == 'ì€ìƒ‰' %}#C0C0C0
                                {% elif color == 'ê¸ˆìƒ‰' %}#FFD700
                                {% else %}#7c3aed{% endif %};">
                            </div>
                            <p class="mt-3 mb-0 fw-bold text-white" style="font-size: 1.1rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">{{ color }}</p>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="d-flex justify-content-center flex-wrap">
                        <div class="m-3 text-center">
                            <div style="width: 100px; height: 100px; border-radius: 50%; margin: 0 auto; box-shadow: 0 8px 20px rgba(0,0,0,0.3), inset 0 -5px 10px rgba(0,0,0,0.2), inset 0 5px 10px rgba(255,255,255,0.2); border: 3px solid rgba(255, 255, 255, 0.3); background: #87CEEB;"></div>
                            <p class="mt-3 mb-0 fw-bold text-white" style="font-size: 1.1rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">í•˜ëŠ˜ìƒ‰</p>
                        </div>
                        <div class="m-3 text-center">
                            <div style="width: 100px; height: 100px; border-radius: 50%; margin: 0 auto; box-shadow: 0 8px 20px rgba(0,0,0,0.3), inset 0 -5px 10px rgba(0,0,0,0.2), inset 0 5px 10px rgba(255,255,255,0.2); border: 3px solid rgba(255, 255, 255, 0.3); background: #90EE90;"></div>
                            <p class="mt-3 mb-0 fw-bold text-white" style="font-size: 1.1rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">ì—°ë‘ìƒ‰</p>
                        </div>
                        <div class="m-3 text-center">
                            <div style="width: 100px; height: 100px; border-radius: 50%; margin: 0 auto; box-shadow: 0 8px 20px rgba(0,0,0,0.3), inset 0 -5px 10px rgba(0,0,0,0.2), inset 0 5px 10px rgba(255,255,255,0.2); border: 3px solid rgba(255, 255, 255, 0.3); background: #800080;"></div>
                            <p class="mt-3 mb-0 fw-bold text-white" style="font-size: 1.1rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">ë³´ë¼ìƒ‰</p>
                        </div>
                    </div>
                    {% endif %}

                    <p class="text-center text-white opacity-75 mt-4 mb-0">
                        ì´ ìƒ‰ìƒë“¤ì„ ì˜·ì´ë‚˜ ì•¡ì„¸ì„œë¦¬ì— í™œìš©í•˜ë©´ ì˜¤ëŠ˜ í•˜ë£¨ê°€ ë”ìš± í–‰ìš´ìœ¼ë¡œ ê°€ë“í•  ê²ƒì…ë‹ˆë‹¤!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Lucky Item Section -->
    <div class="row justify-content-center mb-4">
        <div class="col-lg-10">
            <div class="glass-card">
                <div class="card-body p-4 p-md-5">
                    <h4 class="text-white text-center mb-4">
                        <i class="fas fa-gem text-warning me-2"></i>
                        ì˜¤ëŠ˜ì˜ í–‰ìš´ ì•„ì´í…œ
                    </h4>
                    <p class="text-center text-white opacity-75 mb-4">ì˜¤ëŠ˜ ë‹¹ì‹ ì—ê²Œ í–‰ìš´ì„ ê°€ì ¸ë‹¤ ì¤„ ì•„ì´í…œë“¤</p>

                    {% if fortune.lucky_item %}
                    <div class="row g-4 justify-content-center align-items-stretch">
                        <div class="col-md-5 d-flex">
                            <div class="lucky-item-card text-center p-4 w-100 d-flex flex-column"
                                 style="background: rgba(124, 58, 237, 0.15); border: 1px solid rgba(124, 58, 237, 0.3); border-radius: 15px;"
                                 onclick="this.querySelector('.item-desc-toggle').classList.toggle('show'); this.querySelector('.toggle-icon').classList.toggle('fa-chevron-down'); this.querySelector('.toggle-icon').classList.toggle('fa-chevron-up'); var txt = this.querySelector('.toggle-text'); txt.textContent = txt.textContent === 'ì„¤ëª… ë³´ê¸°' ? 'ì ‘ê¸°' : 'ì„¤ëª… ë³´ê¸°';">
                                <div class="mb-2">
                                    <span class="badge bg-primary">ìš´ì„¸ ê¸°ë°˜</span>
                                </div>
                                <span class="lucky-item-icon d-block mb-3">{{ fortune.lucky_item.emoji|default:"ğŸ" }}</span>
                                <h5 class="text-white fw-bold mb-2" style="word-break: keep-all;">{{ fortune.lucky_item.main|default:"í–‰ìš´ ì•„ì´í…œ" }}</h5>
                                <div class="item-desc-toggle">
                                    <p class="text-white opacity-75 small mb-0">{{ fortune.lucky_item.description|default:"" }}</p>
                                </div>
                                <div class="toggle-hint mt-2">
                                    <i class="fas fa-chevron-down toggle-icon"></i>
                                    <span class="small text-white opacity-50 ms-1 toggle-text">ì„¤ëª… ë³´ê¸°</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5 d-flex">
                            <div class="lucky-item-card text-center p-4 w-100 d-flex flex-column"
                                 style="background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 15px;"
                                 onclick="this.querySelector('.item-desc-toggle').classList.toggle('show'); this.querySelector('.toggle-icon').classList.toggle('fa-chevron-down'); this.querySelector('.toggle-icon').classList.toggle('fa-chevron-up'); var txt = this.querySelector('.toggle-text'); txt.textContent = txt.textContent === 'ì„¤ëª… ë³´ê¸°' ? 'ì ‘ê¸°' : 'ì„¤ëª… ë³´ê¸°';">
                                <div class="mb-2">
                                    <span class="badge bg-info">{{ fortune.zodiac_sign }} ì¶”ì²œ</span>
                                </div>
                                <span class="lucky-item-icon d-block mb-3">{{ fortune.lucky_item.zodiac_emoji|default:"â­" }}</span>
                                <h5 class="text-white fw-bold mb-2" style="word-break: keep-all;">{{ fortune.lucky_item.zodiac|default:"ë³„ìë¦¬ ì•„ì´í…œ" }}</h5>
                                <div class="item-desc-toggle">
                                    <p class="text-white opacity-75 small mb-0">{{ fortune.lucky_item.zodiac_description }}</p>
                                </div>
                                <div class="toggle-hint mt-2">
                                    <i class="fas fa-chevron-down toggle-icon"></i>
                                    <span class="small text-white opacity-50 ms-1 toggle-text">ì„¤ëª… ë³´ê¸°</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center">
                        <span class="lucky-item-icon">ğŸ</span>
                        <h5 class="text-white mt-3">ë¯¸ë‹ˆ í‚¤ë§</h5>
                        <p class="text-white opacity-75">ìƒˆë¡œìš´ ë¬¸ì„ ì—¬ëŠ” ì—´ì‡ ê°€ ë©ë‹ˆë‹¤</p>
                    </div>
                    {% endif %}

                    <div class="text-center mt-4">
                        <a href="{% url 'fortune:item_check' %}" class="btn btn-outline-light rounded-pill px-4">
                            <i class="fas fa-search me-2"></i> ë‚´ ì•„ì´í…œ í–‰ìš´ë„ ì¸¡ì •í•˜ê¸°
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lucky Numbers Section (ì„±ì¸ë§Œ í‘œì‹œ) -->
    {% if not is_minor %}
    <div class="row justify-content-center mb-4">
        <div class="col-lg-10">
            <div class="glass-card">
                <div class="card-body p-4 p-md-5">
                    <h4 class="text-white text-center mb-4">
                        <i class="fas fa-dice text-warning me-2"></i>
                        ì¬ë¯¸ë¡œ ë³´ëŠ” ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë¡œë˜ ë²ˆí˜¸
                    </h4>
                    {% if fortune.lotto_numbers %}
                    <div class="lotto-numbers">
                        {% for number in fortune.lotto_numbers %}
                        <div class="lotto-ball" style="background:
                            {% if number <= 10 %}linear-gradient(135deg, #fbbf24, #d97706)
                            {% elif number <= 20 %}linear-gradient(135deg, #60a5fa, #2563eb)
                            {% elif number <= 30 %}linear-gradient(135deg, #f87171, #dc2626)
                            {% elif number <= 40 %}linear-gradient(135deg, #34d399, #059669)
                            {% else %}linear-gradient(135deg, #c084fc, #7c3aed){% endif %};">
                            {{ number }}
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center">
                        <p class="text-white opacity-75">ë¡œë˜ ë²ˆí˜¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                    {% endif %}
                    <p class="text-white opacity-50 mt-4 text-center">
                        <small>â€» ì˜¤ë½ìš©ì´ë©° ì‹¤ì œ ë‹¹ì²¨ê³¼ëŠ” ë¬´ê´€í•©ë‹ˆë‹¤</small>
                    </p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Recommendations -->
    <div class="row justify-content-center mb-4">
        <div class="col-lg-10">
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="glass-card h-100 p-4 text-center hover-lift">
                        <i class="fas fa-tshirt fa-3x text-primary mb-3"></i>
                        <h5 class="text-white">OOTD ì¶”ì²œ ë°›ê¸°</h5>
                        <p class="text-white opacity-75 small mb-4">ì˜¤ëŠ˜ì˜ ë‚ ì”¨ì™€ í–‰ìš´ìƒ‰ ê¸°ë°˜ ì½”ë””</p>
                        <a href="{% url 'recommendations:ootd' %}" class="btn btn-outline-light rounded-pill px-4">
                            ì¶”ì²œ ë°›ê¸° <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="glass-card h-100 p-4 text-center hover-lift">
                        <i class="fas fa-utensils fa-3x text-success mb-3"></i>
                        <h5 class="text-white">ë©”ë‰´ ì¶”ì²œ ë°›ê¸°</h5>
                        <p class="text-white opacity-75 small mb-4">ìš´ì„¸ì— ë§ëŠ” í–‰ìš´ì˜ ë©”ë‰´</p>
                        <a href="{% url 'recommendations:menu' %}" class="btn btn-outline-light rounded-pill px-4">
                            ì¶”ì²œ ë°›ê¸° <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
        <!-- No Fortune Yet -->
        <div class="glass-card p-5 text-center">
            <i class="fas fa-question-circle fa-5x text-white opacity-50 mb-4"></i>
            <h3 class="text-white mb-3">ìš´ì„¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p class="text-white opacity-75 mb-4">ë¨¼ì € ìš´ì„¸ë¥¼ ê³„ì‚°í•´ì£¼ì„¸ìš”</p>
            <a href="{% url 'fortune:calculate' %}" class="btn btn-primary btn-lg rounded-pill px-5">
                <i class="fas fa-calculator me-2"></i> ìš´ì„¸ ê³„ì‚°í•˜ê¸°
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animation Helper: EaseOutCubic
    function easeOutCubic(x) {
        return 1 - Math.pow(1 - x, 3);
    }

    // Generic Animation Function
    function animateValue(duration, onUpdate) {
        const startTime = performance.now();
        
        function step(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const easedProgress = easeOutCubic(progress);
            
            onUpdate(easedProgress);
            
            if (progress < 1) {
                requestAnimationFrame(step);
            }
        }
        
        requestAnimationFrame(step);
    }

    // 1. Score Circle Animation
    const progressCircle = document.querySelector('.fortune-circle-progress');
    const scoreElement = document.querySelector('.fortune-score-text .score');
    
    if (progressCircle && scoreElement) {
        // Get score from data attribute, fallback to 0 if missing
        let targetScore = parseInt(progressCircle.getAttribute('data-score'));
        if (isNaN(targetScore)) targetScore = 0;

        const circumference = 2 * Math.PI * 100; // ~628
        
        // Initial State
        progressCircle.style.transition = 'none'; // Disable CSS transition for JS control
        progressCircle.style.strokeDasharray = circumference;
        progressCircle.style.strokeDashoffset = circumference; // Start empty
        scoreElement.textContent = "0"; // Start at 0
        
        // Start Animation
        animateValue(1500, (progress) => {
            const currentScore = targetScore * progress;
            const offset = circumference - (currentScore / 100 * circumference);
            
            // Update DOM
            scoreElement.textContent = Math.round(currentScore);
            progressCircle.style.strokeDashoffset = offset;
        });
    }
    
    // 2. Sub Score Bar Animation
    function animateBar(container) {
        const fill = container.querySelector('.sub-score-fill');
        const text = container.querySelector('.score-text');
        
        if (fill && text) {
            // Get target score from the inline style width (e.g., "80%")
            // We store the target in a data attribute to persist it across animations
            let targetScore = parseFloat(fill.getAttribute('data-target'));
            if (isNaN(targetScore)) {
                targetScore = parseFloat(fill.style.width) || 0;
                fill.setAttribute('data-target', targetScore);
            }
            
            // Initial State
            fill.style.transition = 'none'; // Disable CSS transition
            fill.style.width = '0%';
            text.textContent = '0%';
            
            // Start Animation
            animateValue(1000, (progress) => {
                const currentScore = targetScore * progress;
                
                // Update DOM
                fill.style.width = `${currentScore}%`;
                text.textContent = `${Math.round(currentScore)}%`;
            });
        }
    }

    // Initial animation for active tab
    const activeTabPane = document.querySelector('.tab-pane.active');
    if (activeTabPane) {
        const bar = activeTabPane.querySelector('.sub-score-bar');
        if (bar) animateBar(bar);
    }

    // Listen for tab changes
    const tabEls = document.querySelectorAll('a[data-bs-toggle="tab"]');
    tabEls.forEach(tabEl => {
        tabEl.addEventListener('shown.bs.tab', function (event) {
            const targetId = event.target.getAttribute('href'); // e.g., #money
            const targetPane = document.querySelector(targetId);
            if (targetPane) {
                const bar = targetPane.querySelector('.sub-score-bar');
                if (bar) animateBar(bar);
            }
        });
    });
});
</script>
{% endblock %}