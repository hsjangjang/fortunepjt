{% extends 'base.html' %}

{% block title %}ë©”ë‰´ ì¶”ì²œ - Fortune Life{% endblock %}

{% block content %}
<div class="page-container">
    <div class="content-wrapper wide">
        {# í˜ì´ì§€ í—¤ë” #}
        {% include 'includes/page_header.html' with title="ì˜¤ëŠ˜ì˜ ë©”ë‰´ ì¶”ì²œ" subtitle="ìš´ì„¸ì™€ í–‰ìš´ìƒ‰ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ë§ì¶¤ ë©”ë‰´" icon="fas fa-utensils" icon_color="text-success" %}

        {% if not user.is_authenticated %}
        {# ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì ë©”ì‹œì§€ #}
        <div class="card-base card-lg">
            <div class="empty-state">
                <i class="fas fa-lock empty-icon"></i>
                <h3 class="empty-title">ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”</h3>
                <p class="empty-text">ë©”ë‰´ ì¶”ì²œ ì„œë¹„ìŠ¤ëŠ” íšŒì› ì „ìš© ê¸°ëŠ¥ì…ë‹ˆë‹¤.</p>
                <div class="action-buttons">
                    <a href="{% url 'users:login' %}?next={% url 'recommendations:menu' %}" class="btn btn-primary rounded-pill px-4">
                        ë¡œê·¸ì¸í•˜ê¸°
                    </a>
                    <a href="{% url 'users:register' %}" class="btn btn-outline-light rounded-pill px-4">
                        íšŒì›ê°€ì…í•˜ê¸°
                    </a>
                </div>
            </div>
        </div>
        {% else %}

        {# ìš´ì„¸ ê¸°ë°˜ ì •ë³´ í‘œì‹œ #}
        {% with fortune_data=request.session.fortune_data %}
        {% if fortune_data %}
        <div class="card-base card-md section-spacing">
            <div class="badge-row">
                <div class="text-center px-4">
                    <h6 class="text-white opacity-75 mb-2">ì˜¤ëŠ˜ì˜ ìš´ì„¸ ì ìˆ˜</h6>
                    <h3 class="text-primary-light mb-0">{{ fortune_data.fortune_score|default:0 }}ì </h3>
                </div>
                <div class="text-center px-4">
                    <h6 class="text-white opacity-75 mb-2">ë³„ìë¦¬</h6>
                    <h4 class="text-white mb-0">{{ fortune_data.zodiac_sign|default:"-" }}</h4>
                </div>
                <div class="text-center px-4">
                    <h6 class="text-white opacity-75 mb-2">ë </h6>
                    <h4 class="text-white mb-0">{{ fortune_data.chinese_zodiac|default:"-" }}</h4>
                </div>
            </div>
        </div>
        {% endif %}
        {% endwith %}

        {# Main Menu Recommendations #}
        <div class="card-grid cols-2 section-spacing">
            {% for rec in recommendations %}
            <div class="card-base card-md card-interactive position-relative overflow-hidden">
                {# Subtle Gradient Background Glow #}
                <div class="position-absolute top-0 start-50 translate-middle-x mt-n4"
                     style="width: 150px; height: 150px; background: {{ rec.bg_gradient }}; filter: blur(60px); opacity: 0.2;"></div>

                <div class="text-center position-relative">
                    <div class="mb-3">
                        <span class="badge rounded-pill border border-white border-opacity-25 px-3 py-2 text-white fs-5"
                              style="background: rgba(255,255,255,0.1); backdrop-filter: blur(5px);">
                            {% if rec.rank == 1 %}ğŸ¥‡ 1ìˆœìœ„ ì¶”ì²œ{% else %}ğŸ¥ˆ 2ìˆœìœ„ ì¶”ì²œ{% endif %}
                        </span>
                    </div>

                    <div class="menu-icon mb-4 animate-float" style="font-size: 80px; text-shadow: 0 10px 20px rgba(0,0,0,0.3);">
                        {{ rec.menu.icon }}
                    </div>

                    <h3 class="fw-bold mb-2 text-white">{{ rec.menu.name }}</h3>
                    <p class="text-white opacity-50 mb-4">{{ rec.menu.category }}</p>

                    <div class="mb-4">
                        <span class="badge bg-primary bg-opacity-75 text-white px-3 py-2 rounded-pill">
                            <i class="fas fa-palette me-1"></i> {{ rec.color }}
                        </span>
                    </div>

                    <div class="info-box">
                        <p class="small mb-0 text-white">
                            {{ rec.menu.desc }}
                        </p>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="text-center">
                <p class="text-white">ì¶”ì²œí•  ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            {% endfor %}
        </div>

        {# Additional Recommendations #}
        <div class="card-base card-lg">
            <h4 class="card-title mb-4">
                <i class="fas fa-utensils text-primary"></i>
                ê·¸ ì™¸ ì¶”ì²œ ë©”ë‰´
            </h4>

            <div class="card-grid cols-3">
                {% for item in other_recommendations %}
                <div class="info-box text-center hover-lift">
                    <div class="mb-2" style="font-size: 32px;">
                        {{ item.menu.icon }}
                    </div>
                    <h6 class="small mb-1 text-white">{{ item.menu.name }}</h6>
                    <span class="badge bg-secondary bg-opacity-50 text-white" style="font-size: 0.7rem;">{{ item.color }}</span>
                </div>
                {% empty %}
                <div class="text-center">
                    <p class="text-white opacity-50">ì¶”ê°€ ì¶”ì²œ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        {% endif %}
    </div>
</div>
{% endblock %}