{% extends 'base.html' %}

{% block title %}로그인 - Fortune Life{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-5 mx-auto">
        <div class="glass-card shadow-lg">
            <div class="card-body p-5">
                <h2 class="text-center mb-4 text-white">
                    <i class="fas fa-sign-in-alt text-primary"></i> 로그인
                </h2>
                
                <form method="POST" action="{% url 'users:login' %}">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label class="form-label text-white">이메일 또는 아이디</label>
                        <div class="input-group">
                            <span class="input-group-text bg-transparent text-white border-secondary"><i class="fas fa-user"></i></span>
                            <input type="text" name="username" class="form-control text-white bg-dark border-secondary" required autofocus oninput="convertKoreanToEnglish(this)" style="ime-mode: disabled;">
                            <script>
                                let isConverting = false;
                                function convertKoreanToEnglish(input) {
                                    if (isConverting) return;

                                    const k2e = {
                                        'ㅂ':'q','ㅈ':'w','ㄷ':'e','ㄱ':'r','ㅅ':'t',
                                        'ㅛ':'y','ㅕ':'u','ㅑ':'i','ㅐ':'o','ㅔ':'p',
                                        'ㅁ':'a','ㄴ':'s','ㅇ':'d','ㄹ':'f','ㅎ':'g',
                                        'ㅗ':'h','ㅓ':'j','ㅏ':'k','ㅣ':'l',
                                        'ㅋ':'z','ㅌ':'x','ㅊ':'c','ㅍ':'v','ㅠ':'b','ㅜ':'n','ㅡ':'m',
                                        'ㅃ':'Q','ㅉ':'W','ㄸ':'E','ㄲ':'R','ㅆ':'T',
                                        'ㅒ':'O','ㅖ':'P'
                                    };

                                    const value = input.value;
                                    const start = input.selectionStart;
                                    const end = input.selectionEnd;

                                    // 한글 자모 변환
                                    let newValue = '';
                                    for (let i = 0; i < value.length; i++) {
                                        const char = value[i];
                                        if (k2e[char]) {
                                            newValue += k2e[char];
                                        } else {
                                            newValue += char;
                                        }
                                    }

                                    // 허용 문자만 남기기
                                    newValue = newValue.replace(/[^A-Za-z0-9@._-]/g, '');

                                    if (value !== newValue) {
                                        isConverting = true;
                                        input.value = newValue;
                                        input.setSelectionRange(Math.min(start, newValue.length), Math.min(end, newValue.length));
                                        isConverting = false;
                                    }
                                }
                            </script>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label text-white">비밀번호</label>
                        <div class="input-group">
                            <span class="input-group-text bg-transparent text-white border-secondary"><i class="fas fa-lock"></i></span>
                            <input type="password" name="password" class="form-control text-white bg-dark border-secondary" required>
                        </div>
                    </div>
                    
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" name="remember_me" id="remember">
                        <label class="form-check-label text-white" for="remember">
                            로그인 상태 유지
                        </label>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-sign-in-alt"></i> 로그인
                        </button>
                    </div>
                </form>
                
                <hr class="my-4 border-secondary">
                
                <div class="text-center">
                    <p class="mb-2 text-white">아직 회원이 아니신가요?</p>
                    <a href="{% url 'users:register' %}" class="btn btn-outline-light">
                        회원가입하기
                    </a>
                </div>
                
                <div class="text-center mt-3">
                    <a href="{% url 'users:password_reset' %}" class="text-decoration-none text-white-50 small">
                        비밀번호를 잊으셨나요?
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
